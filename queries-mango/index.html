<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="9ci">
        <link rel="canonical" href="https://yakworks.github.io/gorm-tools/queries-mango/">
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Mango Query - Gorm Tools Grails Plugin</title>
        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../css/highlight.css">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
	
	<script src="../js/jquery-1.10.2.min.js"></script>
        <script src="../js/bootstrap-3.0.3.min.js"></script>
        <script src="../js/highlight.pack.js"></script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="..">Gorm Tools Grails Plugin</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                    <li >
                        <a href="..">Overview</a>
                    </li>
                    <li >
                        <a href="../release-notes/">Release Notes</a>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Repository Pattern <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../repository/intro/">Quick Start</a>
</li>
                            
<li >
    <a href="../repository/ref/">Reference</a>
</li>
                            
<li >
    <a href="../repository/databinding/">Databinding</a>
</li>
                        </ul>
                    </li>
                    <li class="active">
                        <a href="./">Mango Query</a>
                    </li>
                    <li >
                        <a href="../async/">Async</a>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Toolbox <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../id-generation/">Id Generation</a>
</li>
                            
<li >
    <a href="../gorm-utils/">GormUtils Class</a>
</li>
                            
<li >
    <a href="../beanPathTools/">Bean Path Tools</a>
</li>
                            
<li >
    <a href="../working-with-dates/">Date Utils</a>
</li>
                        </ul>
                    </li>
                    <li >
                        <a href="../testing/">Testing</a>
                    </li>
                    <li >
                        <a href="../api-docs/">API Docs</a>
                    </li>
                    <li >
                        <a href="../usefulLinks/">Useful Links</a>
                    </li>
                </ul>

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                    <li >
                        <a rel="next" href="../repository/databinding/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../async/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                    <li>
                        <a href="https://github.com/yakworks/gorm-tools">yakworks/gorm-tools
                        </a>
                    </li>
            </ul>
        </div>
    </div>
</div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#mango-overview">Mango Overview</a></li>
            <li><a href="#restful-api-query">Restful API query</a></li>
            <li><a href="#mango-ql">Mango QL</a></li>
            <li><a href="#mango-query">Mango query</a></li>
            <li><a href="#q-or-quick-search">Q or Quick Search</a></li>
            <li><a href="#configuration">Configuration</a></li>
            <li><a href="#mango-api">Mango API</a></li>
            <li><a href="#count-totals">Count totals</a></li>
        <li class="main "><a href="#scrollablequery">ScrollableQuery</a></li>
            <li><a href="#execute-a-closure-for-each-record">Execute a closure for each record</a></li>
            <li><a href="#execute-a-closure-for-each-batch-of-records">Execute a closure for each batch of records</a></li>
            <li><a href="#fetching-a-list-of-all-records">Fetching a list of all records:</a></li>
        <li class="main "><a href="#grailsparametermaprowmapper">GrailsParameterMapRowMapper</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<p>Gorm-tools provides a convenient way for iterating over records which correspond to a given SQL query.</p>
<h2 id="mango-overview">Mango Overview</h2>
<p>The primary motive here is to create an easy dynamic way to query via a rest api or using a simple map.
The repository comes with a <code>query(criteriaMap, closure)</code> method. It allows to get paged list of entities restricted by
the properties in the <code>criteriaMap</code>. The map could be passed as JSON string or Map. All restrictions should be under 
<code>criteria</code> keyword by default, but it can be changed with <a href="./#configuration">config</a>.</p>
<p>Anything in the optional closure will be passed into Gorm/Hibernate criteria closure</p>
<ul>
<li>A lot of inspiration was drawn from <a href="https://restdb.io/docs/querying-with-the-api">Restdb.io</a>{.new-tab}</li>
<li>the query language is similar to <a href="https://docs.mongodb.com/manual/reference/operator/query/">Mongo's</a>{.new-tab}</li>
<li>and CouchDB's new <a href="http://docs.couchdb.org/en/latest/api/database/find.html#selector-syntax">Mango selector-syntax</a>{.new-tab}</li>
<li>Also inspired by <a href="https://github.com/2do2go/json-sql/">json-sql</a>{.new-tab}</li>
</ul>
<blockquote>
<p>:memo: 
Whilst selectors have many similarities with MongoDB query documents, 
these arise more from a similarity of purpose and do not necessarily extend to commonality of function or result.</p>
</blockquote>
<p><strong>Basic example</strong></p>
<pre><code class="java">Org.repo.query([
  criteria: [name: &quot;Bill%&quot;, type: &quot;New&quot;],
  sort: [name:&quot;asc&quot;],
  max: 20
]){
  gt &quot;id&quot;, 5
}

</code></pre>

<p>The same result can be reached with criteria:</p>
<pre><code class="javascript">Criteria criteria = Org.createCriteria()
criteria.list(max: 20) {
    ilike &quot;name&quot;, &quot;Bill%&quot;
    eq &quot;type&quot;, &quot;New&quot;
    gt &quot;id&quot;, 5
    order(&quot;name&quot;, &quot;asc&quot;)
}
</code></pre>

<h3 id="restful-api-query">Restful API query</h3>
<p>See the docs here for more examples and info https://yakworks.github.io/gorm-rest-api/</p>
<h3 id="mango-ql">Mango QL</h3>
<p>The Mango query language is similar to <a href="https://docs.mongodb.com/manual/reference/operator/query/">Mongo's</a>
and CouchDB's new <a href="http://docs.couchdb.org/en/latest/api/database/find.html#selector-syntax">Mango selector-syntax</a>
with some inspiration from <a href="https://github.com/2do2go/json-sql/">json-sql</a> as well</p>
<h4 id="logical">Logical</h4>
<table>
<thead>
<tr>
<th>Op</th>
<th>Description</th>
<th>Examples</th>
</tr>
</thead>
<tbody>
<tr>
<td>$and</td>
<td>default</td>
<td><code>$and: [ {"name": "Belak"}, {"status": "D"} ]</code> <br> equivalent to <code>"name": "Belak", "status": "D"</code></td>
</tr>
<tr>
<td>$or</td>
<td>"ors" them all</td>
<td><code>$or: [ {"name": "Belak"}, {"fork": true} ]</code> <br> <code>$or: {"name": "Belak", "fork": true }</code></td>
</tr>
<tr>
<td>$not</td>
<td>ALL not equal, !=, &lt;&gt;</td>
<td><code>$not:{ "status": "Destroyed", "dateStatus": "2371" }</code></td>
</tr>
<tr>
<td>$nor</td>
<td>ANY one is not equal</td>
<td><code>$nor:{ "name": "Romulan", "fork": 12</code>}</td>
</tr>
</tbody>
</table>
<h4 id="comparison">Comparison</h4>
<table>
<thead>
<tr>
<th>Op</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>$gt</td>
<td>&gt;  greater than</td>
<td><code>"cargo": {"$gt": 10000}</code></td>
</tr>
<tr>
<td>$gte</td>
<td>&gt;= greater than or equal</td>
<td><code>"cargo": {"$gte": 10000}</code></td>
</tr>
<tr>
<td>$lt</td>
<td>&lt;  less than</td>
<td><code>"cargo": {"$lt": 10000}</code></td>
</tr>
<tr>
<td>$lte</td>
<td>&lt;= less than or equal</td>
<td><code>"cargo": {"$lte": 10000}</code></td>
</tr>
<tr>
<td>$between</td>
<td>between two distinct values</td>
<td><code>"dateStatus": {"$between": [2300, 2400]}</code></td>
</tr>
<tr>
<td>$like</td>
<td>like expression</td>
<td><code>"name": {"$like": "Rom%"}</code></td>
</tr>
<tr>
<td>$ilike</td>
<td>like auto-append %</td>
<td><code>"name": {"$ilike": "rom"}</code></td>
</tr>
<tr>
<td>$eq</td>
<td>= equal, concieince for builders</td>
<td><code>"salary": {"$eq": 10}</code> | <code>"salary": 10</code></td>
</tr>
<tr>
<td>$ne</td>
<td>not equal, !=, &lt;&gt;</td>
<td><code>"age" : {"$ne" : 12}}</code></td>
</tr>
<tr>
<td>$in</td>
<td>Match any value in array</td>
<td><code>"field" : {"$in" : [value1, value2, ...]</code></td>
</tr>
<tr>
<td>$nin</td>
<td>Not match any value in array</td>
<td><code>"field" : {"$nin" : [value1, value2, ...]}</code></td>
</tr>
<tr>
<td>$isNull</td>
<td>Value is null</td>
<td><code>"name": "$isNull" \|</code>"name": null</td>
</tr>
<tr>
<td>$isNotNull</td>
<td>Value is not null</td>
<td><code>"name": "$isNotNull" \|</code>"name":{$ne: null}</td>
</tr>
</tbody>
</table>
<h4 id="fields">Fields</h4>
<table>
<thead>
<tr>
<th>Op</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>$gtf</td>
<td>&gt;  another field</td>
<td><code>"cargo": {"$gtf": "maxCargo"}</code></td>
</tr>
<tr>
<td>$gtef</td>
<td>&gt;= field</td>
<td><code>"cargo": {"$gtef": "maxCargo"}</code></td>
</tr>
<tr>
<td>$ltf</td>
<td>&lt;  field</td>
<td><code>"cargo": {"$ltf": "maxCargo"}</code></td>
</tr>
<tr>
<td>$ltef</td>
<td>&lt;= field</td>
<td><code>"cargo": {"$ltef": "maxCargo"}</code></td>
</tr>
<tr>
<td>$eqf</td>
<td>= field</td>
<td><code>"cargo": {"$eqf": "controlTotal"}</code></td>
</tr>
<tr>
<td>$nef</td>
<td>not equal, !=, &lt;&gt;</td>
<td><code>"cargo" : {"$nef" : "controlTotal"}}</code></td>
</tr>
</tbody>
</table>
<h4 id="convert-to-mango-ql">Convert to Mango QL</h4>
<p>The <a href="https://yakworks.github.io/gorm-tools/api/gorm/tools/mango/MangoTidyMap.html">MangoTidyMap utility</a>
transforms parameters map to Mango QL criteria map. 
Here is several examples of usage:</p>
<pre><code class="java">assert MangoTidyMap.tidy([a:5]) == [a:['$eq':5]]
assert MangoTidyMap.tidy([b:&quot;Bill%&quot;]) == [b:['$ilike':5]]
assert MangoTidyMap.tidy([c: [1,2,3]]) == [c:['$in':[1,2,3]]]

</code></pre>

<p>One of the useful features of the MangoTidyMap is that it converts path to nested map which is required by <a href="./#mango-query">mangoQuery</a>  </p>
<pre><code class="java">assert MangoTidyMap.tidy['a.b.c': 3]) == [a:[b:[c:['$eq':3]]]]
</code></pre>

<p>For more example take a look on <a href="https://github.com/yakworks/gorm-tools/blob/master/plugin/src/test/groovy/gorm/tools/mango/MangoTidyMapSpec.groovy">MangoTidyMapSpec</a> </p>
<h3 id="mango-query">Mango query</h3>
<p>The repository by default does not have all the features of mango service, just <code>buildCriteria</code> and <code>query</code> methods, but both automatically
convert map params to mango map, so just <code>params</code> or <code>request.JSON</code> can be passed. </p>
<p>See <a href="./#mango-api">Mango Api</a> to know all features that are provided.</p>
<h4 id="examples">Examples</h4>
<p>Bellow will be a list of supported syntax for params in json format, which is supported:
Assume we are running these on star trek characters http://stapi.co/api/v1/rest/character?uid=CHMA0000128908</p>
<pre><code class="js">{
  &quot;criteria&quot;: {
    &quot;name&quot;: &quot;Kira%&quot;, /* if it ends with % then it will us an ilike */
    &quot;gender&quot;: &quot;F&quot;, //no % its straight up
    &quot;placeOfBirth&quot;: {&quot;$ilike&quot;: &quot;bajor%&quot;}, /* a case-insensitive 'like' expression appends the % */
    &quot;hologram&quot;: true, /* boolean */
    &quot;createdDate&quot;: &quot;1993-05-16T00:00:00.000Z&quot;, // dates
    &quot;dateOfBirth&quot;: &quot;1957-07-26&quot; // dates
    &quot;placeOfBirth&quot;: {&quot;$eqf&quot;: &quot;$placeOfDeath&quot;} //equals another field in set
  },
  &quot;sort&quot;:&quot;name&quot; // asc by default
}
</code></pre>

<p>This would produce in a round about way with criteria builders a where clause like this</p>
<pre><code class="sql">  .. name like &quot;Kira%&quot; AND gender=&quot;F&quot; AND placeOfBirth like &quot;bajor%&quot; AND hologram = true
  AND createdDate = ??? AND dateOfBirth = ??? AND placeOfBirth = placeOfDeath
  ORDER BY name ASC, dateOfBirth DESC;
</code></pre>

<h4 id="associations">Associations</h4>
<pre><code class="js">{
  &quot;criteria&quot;: {
    &quot;customer.id&quot;: 101,
    &quot;customerId&quot;: 101, /* check if domain has customerId property, if not then uses customer.id 101 above */
    &quot;customer&quot;: { /* nested object way */
      &quot;id&quot;: 101,
      &quot;name&quot;: &quot;Wal%&quot;
    }
  }
  &quot;sort&quot;: {
    &quot;customer.name&quot;: &quot;asc&quot;,
    &quot;tranDate&quot;: &quot;desc&quot;
  }
}
</code></pre>

<h4 id="in-clause">IN Clause</h4>
<pre><code class="js">{
  &quot;criteria&quot;: {
    &quot;customer.id&quot;: [101,102,103], /* an array means it will use in/inList */
    &quot;customer&quot;: [{&quot;id&quot;:101},{&quot;id&quot;:102},{&quot;id&quot;:103}], //can be in summarized object form as well
    &quot;customer.id&quot;: [101,102,103], /* an array means it will use in/inList */
    //the 3 above are different ways to do this
    &quot;customer.id&quot;: {&quot;$in&quot;: [101,102,103]},
    &quot;customer&quot;: {
      &quot;id&quot;: {&quot;$in&quot;: [101,102,103]}
    },

    &quot;customer.id&quot;: {&quot;$nin&quot;: [101,102,103]}, /* an array means it will use `not { in/inList }`*/
  }
}
</code></pre>

<h4 id="fields-comparison-examples">Fields Comparison Examples</h4>
<pre><code class="js">  &quot;amount&quot;: {&quot;$ne&quot;: 50}, /*not equal*/
  &quot;amount&quot;: {&quot;$gt&quot;: 100}, /* greater than value */
  &quot;amount.$gt&quot;: 100 /* another form of the above one, can be useful when json is build, for example from angular model, where  you can't right in object form*/
  &quot;amount&quot;: {&quot;$ge&quot;: 100}, /* greater or equal than value */

  &quot;amount&quot;: {&quot;$lt&quot;: &quot;$origAmount&quot;}, /* less than value of another field*/
  &quot;amount&quot;: {&quot;$le&quot;: &quot;$origAmount&quot;}, /* less or equal than value */

  &quot;amount&quot;:{ //all these will get anded together
    &quot;$gt&quot;: 5.0,
    &quot;$lt&quot;: 15.50,
    &quot;$ne&quot;: 9.99
  },

  &quot;amount&quot;: {&quot;$between&quot;: [0,100]}, /* between value */

  &quot;status&quot;: &quot;$isNull&quot; /* translates to isNull*/
  &quot;status&quot;: {&quot;$isNull&quot;: true}, /* translates to isNull*/
  &quot;status&quot;: {&quot;$isNull&quot;: false}, /* translates to not{ isNull}*/
  &quot;status&quot;: null /* translates to isNull*/
</code></pre>

<h4 id="logical-operators">Logical operators</h4>
<pre><code class="js">    &quot;$or&quot;: { // if a single or then it can be done like this
      &quot;customer.name&quot;:{&quot;$ilike&quot;: &quot;wal&quot;},
      &quot;customer.num&quot;:{&quot;$ilike&quot;: &quot;wal&quot;}
    },
    &quot;$and&quot;:[ // multiple ors would need to look like this in an array. only one and can be present too
      {
        &quot;$or&quot;: {
          &quot;customer.name&quot;: &quot;John&quot;,
          &quot;customer.name&quot;: &quot;Jon&quot;
        }
      },
      {
        &quot;$or&quot;: {
          &quot;customer.name&quot;: &quot;Mark&quot;,
          &quot;customer.name&quot;: &quot;Marc&quot;
        }
      }
    ], /* this would end up generating `.... and ( (customer.name = 'John' or customer.name = 'Jon')
          AND (customer.name = 'Mark' or customer.name = 'Mark') ) ....` */

    &quot;$or&quot;:[ // again you can only have one of these
      { // the and is default and optional and this accomplishes the same thing as example sbelow
        &quot;customer.name&quot;: &quot;Mark&quot;,
        &quot;$or&quot;: {
          &quot;customer.sales&quot;: {&quot;$lt&quot;: 10},
          &quot;customer.sales&quot;: &quot;$isNull&quot;
        }
      },
      {
        &quot;$and&quot;: { //the and can be explicitly specified too if you wish
          &quot;customer.name&quot;: &quot;Jim&quot;,
          &quot;customer.sales&quot;: {&quot;$lt&quot;: 15}
        }
      },
    ], /* this would end up generating
        ....
        AND
        (
          (customer.name = 'mark' and ( customer.sales &lt; 10 or customer.sales IS NULL))
          OR
          (customer.name = 'jim' and customer.sales &lt; 15 )
        )
        .... */
  }
}

</code></pre>

<h3 id="q-or-quick-search">Q or Quick Search</h3>
<p>Q search - similiar to a search engine search that uses a <code>q</code> paramter, 
ability to search by one string in criteria filters against several domain fields, the value for quick
search can be passed in <code>$qSearch</code> or <code>$q</code> keywords. 
There are 2 ways to specify fields that should be searched against:</p>
<ol>
<li>in static property <code>qSearchIncludes</code> as list of strings, see example bellow:</li>
</ol>
<pre><code class="groovy">class Org {
    String name
    Address address

    static qSearchIncludes = [&quot;name&quot;, &quot;address.city&quot;]
    ...

</code></pre>

<ol>
<li>default fields in config</li>
</ol>
<pre><code class="yaml">gorm:
    tools:
        mango:
            qSearchDefault: [name, num, address.city]

</code></pre>

<p>Mango criteria will add <code>%</code> automatically, if quick search string doesn't have it and will apply <code>ilike</code> statement
for each field in <code>qSearchIncludes</code>. If domain field is not string type, then <code>eq</code> statement will be used.</p>
<pre><code class="groovy">Org.repo.search([criteria: [$q: &quot;abc&quot;], max: 20])

</code></pre>

<p>So it is the same as:</p>
<pre><code class="groovy">Criteria criteria = Org.createCriteria()
criteria.list(max: 20) {
    or {
        ilike &quot;name&quot;, &quot;abc%&quot;
        ilike &quot;address.city&quot;, &quot;abc%&quot;
    }
}
</code></pre>

<h3 id="configuration">Configuration</h3>
<p>The default <code>criteria</code> keyword for the restriction map can be changed in config:</p>
<pre><code class="yml">gorm:
    tools:
        mango:
            criteriaKeyName: filters
</code></pre>

<p>With such configuration restrictions for Mango criteria should be under <code>filters</code> keyword.</p>
<h3 id="mango-api">Mango API</h3>
<h4 id="mango-in-the-repository">Mango in the Repository</h4>
<p><a href="../repository/ref/">The Repository</a> implements <a href="https://yakworks.github.io/gorm-tools/api/gorm/tools/mango/api/MangoQueryTrait.html">MangoQueryTrait</a> Trait
which contains implementation for two query methods:</p>
<pre><code class="groovy">DetachedCriteria buildCriteria( Map params=[:], Closure closure=null) {
        mangoQuery.buildCriteria(getDomainClass(), params, closure)
    }
</code></pre>

<p>see docs for <a href="http://gorm.grails.org/latest/hibernate/manual/index.html#detachedCriteria">DetachedCriteria</a></p>
<pre><code class="groovy"> List query(Map params=[:], Closure closure=null){
         mangoQuery.query(getDomainClass(), params, closure)
     }
</code></pre>

<p>returns list of entities with pagination. For pagination take a look at <a href="https://yakworks.github.io/gorm-tools/api/gorm/tools/Pager.html">Pager</a></p>
<p>If one need to override mango bean for a certain repo it can be achieved in two ways:</p>
<ol>
<li>
<p>implement <code>getMangoQuery()</code> method that should return instance of the class that implements <a href="https://yakworks.github.io/gorm-tools/api/gorm/tools/mango/api/MangoQueryApi.html">MangoQueryApi</a></p>
</li>
<li>
<p>register a new bean for custom criteria, and set it for the repo with <code>@Qualifier</code> annotation</p>
</li>
</ol>
<pre><code class="java">beans = {
    newMangoQuery(NewMangoQuery) 
}

</code></pre>

<pre><code class="java">class NewMangoQuery implements MangoQueryApi {

    @Override
    DetachedCriteria buildCriteria(Class domainClass, Map params, Closure closure = null) {
       return null
    }

    @Override
    List query(Class domainClass, Map params, Closure closure = null) {
       return []
    }
}
</code></pre>

<pre><code class="java">class CityRepo extends DefaultGormRepo&lt;City&gt; {

    @Autowired
    @Qualifier(&quot;newMangoQuery&quot;)
    NewMangoQuery mangoQuery
}
</code></pre>

<h4 id="build-mango-criteria">Build Mango criteria</h4>
<p>Under the hood Mango uses <a href="http://gorm.grails.org/latest/hibernate/manual/index.html#detachedCriteria">DetachedCriteria</a> take a look on main <a href="https://github.com/yakworks/gorm-tools/blob/master/plugin/src/main/groovy/gorm/tools/mango/MangoBuilder.groovy#L73">build method</a>
One can see that it normalizes params map to make it Mango QL and then adds restrictions to detached criteria based on map,
if closure is passed then applies it too. </p>
<h3 id="count-totals">Count totals</h3>
<p>If one needs to compute totals for some fields, <a href="https://yakworks.github.io/gorm-tools/api/gorm/tools/mango/MangoQuery.html">MangoQuery</a> 
has <code>countTotals</code> method. Restrictions for it are working in the same way as for query method, so it can be specified 
with params map and criteria closure.</p>
<p>But the repository beans don't contain this method, so one can call it on mangoQuery bean.
To specify what fields sums should be computed for, the list with fields name should be passed.
See example:</p>
<pre><code class="groovy">Org.repo.mangoQuery.countTotals(domainClass, [
  criteria: [name: &quot;Virgin%&quot;, type: &quot;New&quot;]
], [&quot;amount&quot;, credit]){
  gt &quot;id&quot;, 5
}
</code></pre>

<p>Result will be look like: <code>[amount: 1500, credit: 440]</code>, it doesn't take into account pagination.</p>
<h2 id="scrollablequery">ScrollableQuery</h2>
<p>See <a href="https://yakworks.github.io/gorm-tools/api/gorm/tools/jdbc/ScrollableQuery.html">ScrollableQuery</a></p>
<h3 id="execute-a-closure-for-each-record">Execute a closure for each record</h3>
<p>As you can see in the example below, we can specify the SQL query and provide the closure which is called for each record:</p>
<pre><code class="groovy">    ScrollableQuery scrollableQuery = new ScrollableQuery(new ColumnMapRowMapper(), dataSource, 50)

    scrollableQuery.eachRow(&quot;select * from ScrollableQueryTest&quot;) { Object row -&gt;
        println row
    }
</code></pre>

<h3 id="execute-a-closure-for-each-batch-of-records">Execute a closure for each batch of records</h3>
<p>Using <code>eachBatch</code> we can execute a closure for a batch of records.
This closure is called for a specified number of records. For example, code below prints size of each batch
(which is 5) to console:</p>
<pre><code class="groovy">
    scrollableQuery.eachBatch(&quot;select * from ScrollableQueryTest&quot;, 5) { List batch -&gt;
        println &quot;batchSize=${batch.size()}&quot;
    }

</code></pre>

<h3 id="fetching-a-list-of-all-records">Fetching a list of all records:</h3>
<blockquote>
<p>:memo: This method holds all rows in memory, so this should not be used if there is going to be large number of rows.</p>
</blockquote>
<pre><code class="groovy">
    List values = scrollableQuery.rows(&quot;select * from ScrollableQueryTest where value='test'&quot;)

</code></pre>

<h2 id="grailsparametermaprowmapper">GrailsParameterMapRowMapper</h2>
<p>See <a href="https://yakworks.github.io/gorm-tools/api/gorm/tools/jdbc/GrailsParameterMapRowMapper.html">GrailsParameterMapRowMapper</a></p>
<p>Row mapper which allows to convert data from a given ResultSet instance
to a grails parameter map, which can be used for databinding.</p></div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>Copyright &copy; 2020 9ci Inc</p>
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>var base_url = '..';</script>
        <script data-main="../mkdocs/js/search.js" src="../mkdocs/js/require.js"></script>
        <script src="../js/base.js"></script><div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
