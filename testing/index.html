<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="9ci">
        <link rel="canonical" href="https://yakworks.github.io/gorm-tools/testing/">
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Testing - Gorm Tools Grails Plugin</title>
        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../css/highlight.css">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
	
	<script src="../js/jquery-1.10.2.min.js"></script>
        <script src="../js/bootstrap-3.0.3.min.js"></script>
        <script src="../js/highlight.pack.js"></script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="..">Gorm Tools Grails Plugin</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                    <li >
                        <a href="..">Overview</a>
                    </li>
                    <li >
                        <a href="../release-notes/">Release Notes</a>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Repository Pattern <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../repository/intro/">Quick Start</a>
</li>
                            
<li >
    <a href="../repository/ref/">Reference</a>
</li>
                            
<li >
    <a href="../repository/databinding/">Databinding</a>
</li>
                        </ul>
                    </li>
                    <li >
                        <a href="../queries-mango/">Mango Query</a>
                    </li>
                    <li >
                        <a href="../async/">Async</a>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Toolbox <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../id-generation/">Id Generation</a>
</li>
                            
<li >
    <a href="../gorm-utils/">GormUtils Class</a>
</li>
                            
<li >
    <a href="../beanPathTools/">Bean Path Tools</a>
</li>
                            
<li >
    <a href="../working-with-dates/">Date Utils</a>
</li>
                        </ul>
                    </li>
                    <li class="active">
                        <a href="./">Testing</a>
                    </li>
                    <li >
                        <a href="../api-docs/">API Docs</a>
                    </li>
                    <li >
                        <a href="../usefulLinks/">Useful Links</a>
                    </li>
                </ul>

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                    <li >
                        <a rel="next" href="../working-with-dates/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../api-docs/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                    <li>
                        <a href="https://github.com/yakworks/gorm-tools">yakworks/gorm-tools
                        </a>
                    </li>
            </ul>
        </div>
    </div>
</div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#integration-testing">Integration testing</a></li>
            <li><a href="#integrationspechelper">IntegrationSpecHelper</a></li>
            <li><a href="#controllerintegrationspechelper">ControllerIntegrationSpecHelper</a></li>
        <li class="main "><a href="#unit-testing">Unit testing</a></li>
            <li><a href="#datarepotest">DataRepoTest</a></li>
            <li><a href="#domainrepocrudspec">DomainRepoCrudSpec</a></li>
            <li><a href="#domainrepotest">DomainRepoTest</a></li>
            <li><a href="#gormtoolsspechelper">GormToolsSpecHelper</a></li>
            <li><a href="#gormtoolstest">GormToolsTest</a></li>
            <li><a href="#jsonviewspecsetup">JsonViewSpecSetup</a></li>
            <li><a href="#mockjdbcidgenerator">MockJdbcIdGenerator</a></li>
            <li><a href="#externalconfigawarespec">ExternalConfigAwareSpec</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<p>Gorm-tools provides a set of test helpers to make the testing process more convenient</p>
<h2 id="integration-testing">Integration testing</h2>
<h3 id="integrationspechelper">IntegrationSpecHelper</h3>
<p>This is a base trait that contains common logic for integration tests.</p>
<p>Test class should extend <a href="http://spockframework.org/spock/javadoc/1.0/spock/lang/Specification.html">Specification</a>{.new-tab} class explicitly and implement IntegrationSpecHelper:</p>
<pre><code class="groovy">    class SomeSpec extends Specification implements IntegrationSpecHelper
</code></pre>

<p>Due to the fact that Spock conventional approach with setup/cleanup methods doesn't work with traits,
this helper uses <code>@Before</code> / <code>@After</code> JUnit annotations to implement setup and cleanup logic.</p>
<p>As well as setup logic, IntegrationSpecHelper provides a bunch of useful methods which can be used in tests:</p>
<ol>
<li>buildParams - build GrailsParameter map from a given map</li>
<li>flushAndClear - flushes and clears the session cache, the shortcut for <a href="https://github.com/yakworks/gorm-tools/blob/master/plugin/src/main/groovy/gorm/tools/repository/RepoUtil.groovy#L91">RepoUtil.flushAndClear()</a>{.new-tab}</li>
<li>flush - flushes the session cache, the shortcut for <a href="https://github.com/yakworks/gorm-tools/blob/master/plugin/src/main/groovy/gorm/tools/repository/RepoUtil.groovy#L101">RepoUtil.flush()</a>{.new-tab}</li>
<li>clear - clears the session cache, the shortcut for <a href="https://github.com/yakworks/gorm-tools/blob/master/plugin/src/main/groovy/gorm/tools/repository/RepoUtil.groovy#L111">RepoUtil.clear()</a>{.new-tab}</li>
<li>trackMetaClassChanges - start tracking all metaclass changes made after this call, so it can all be undone later</li>
</ol>
<p>IntegrationSpecHelper provides an ability to execute application-specific setup/cleanup logic simply by chaining it with
some custom trait:</p>
<pre><code class="groovy">    class SomeSpec extends Specification implements IntegrationSpecHelper, CustomSpecHelper
</code></pre>

<p>CustomSpecHelper may implement the next methods:</p>
<ol>
<li>specificSetup</li>
<li>specificCleanup</li>
<li>specificSetupSpec</li>
<li>specificCleanupSpec</li>
</ol>
<p>The behavior of these methods is equivalent to Spock conventional methods</p>
<p>!!! note
    Specific method is executed after the method defined in IntegrationSpecHelper</p>
<h3 id="controllerintegrationspechelper">ControllerIntegrationSpecHelper</h3>
<p>This trait extends <strong>IntegrationSpecHelper</strong> and provides common logic
which can be useful when testing controllers. So there is no need to implement IntegrationSpecHelper explicitly.
For example:</p>
<pre><code class="groovy">    class SomeSpec extends Specification implements ControllerIntegrationSpecHelper
</code></pre>

<p>By default it sets up mock request/response pair and injects application context bean. </p>
<p>ControllerIntegrationSpecHelper contains the next util methods:</p>
<ol>
<li>
<p>getControllerName - can be overridden in the test class to return the controller name.
     This name is appended to the request attributes. Returns null by default value.</p>
<p>Also, can be specified as a property:
 <code>groovy
    String controllerName = "Org"</code></p>
</li>
<li>
<p>autowire - autowires bean properties of a given controller and returns the controller instance</p>
</li>
<li>mockRender - adds mock of the <code>render</code> method to a metaclass of a given controller</li>
<li>getCurrentRequestAttributes - returns the current request attributes</li>
</ol>
<p>Util methods from IntegrationSpecHelper are available as well.</p>
<p>!!! note
    In case of using this trait with a custom helper trait, the setup methods will be called in the next order:
    IntegrationSpecHelper -&gt; ControllerIntegrationSpecHelper -&gt; CustomSpecHelper</p>
<h2 id="unit-testing">Unit testing</h2>
<h3 id="datarepotest">DataRepoTest</h3>
<pre><code>TODO
</code></pre>
<h3 id="domainrepocrudspec">DomainRepoCrudSpec</h3>
<pre><code>TODO
</code></pre>
<h3 id="domainrepotest">DomainRepoTest</h3>
<pre><code>TODO
</code></pre>
<h3 id="gormtoolsspechelper">GormToolsSpecHelper</h3>
<pre><code>TODO
</code></pre>
<h3 id="gormtoolstest">GormToolsTest</h3>
<pre><code>TODO
</code></pre>
<h3 id="jsonviewspecsetup">JsonViewSpecSetup</h3>
<pre><code>TODO
</code></pre>
<h3 id="mockjdbcidgenerator">MockJdbcIdGenerator</h3>
<pre><code>TODO
</code></pre>
<h3 id="externalconfigawarespec">ExternalConfigAwareSpec</h3>
<p>The trait makes it possible to load external config during unit tests.
If external-config plugin is installed, the configuration defined in config.locations will be loaded and be made available to unit tests.
DataRepoTest extends ExternalConfigAwareSpec so subclasses does not need to extend it explicitely. </p>
<p><strong>Note:</strong> ExternalConfigAwareSpec uses doWithSpring to define ExternalConfigLoader bean, so that it runs during Grails application 
lifecycle.
If the test overrides doWithSpring, the method in trait will not run. So the test class should explicitely call ExternalConfigAwareSpec
.super.doWithSpring</p></div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>Copyright &copy; 2020 9ci Inc</p>
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>var base_url = '..';</script>
        <script data-main="../mkdocs/js/search.js" src="../mkdocs/js/require.js"></script>
        <script src="../js/base.js"></script><div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
