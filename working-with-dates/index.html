<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="9ci">
        <link rel="canonical" href="https://yakworks.github.io/gorm-tools/working-with-dates/">
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Date Utils - Gorm Tools Grails Plugin</title>
        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../css/highlight.css">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
	
	<script src="../js/jquery-1.10.2.min.js"></script>
        <script src="../js/bootstrap-3.0.3.min.js"></script>
        <script src="../js/highlight.pack.js"></script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="..">Gorm Tools Grails Plugin</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                    <li >
                        <a href="..">Overview</a>
                    </li>
                    <li >
                        <a href="../release-notes/">Release Notes</a>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Repository Pattern <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../repository/intro/">Quick Start</a>
</li>
                            
<li >
    <a href="../repository/ref/">Reference</a>
</li>
                            
<li >
    <a href="../repository/databinding/">Databinding</a>
</li>
                        </ul>
                    </li>
                    <li >
                        <a href="../queries-mango/">Mango Query</a>
                    </li>
                    <li >
                        <a href="../async/">Async</a>
                    </li>
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Toolbox <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../id-generation/">Id Generation</a>
</li>
                            
<li >
    <a href="../gorm-utils/">GormUtils Class</a>
</li>
                            
<li >
    <a href="../beanPathTools/">Bean Path Tools</a>
</li>
                            
<li class="active">
    <a href="./">Date Utils</a>
</li>
                        </ul>
                    </li>
                    <li >
                        <a href="../testing/">Testing</a>
                    </li>
                    <li >
                        <a href="../api-docs/">API Docs</a>
                    </li>
                    <li >
                        <a href="../usefulLinks/">Useful Links</a>
                    </li>
                </ul>

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                    <li >
                        <a rel="next" href="../beanPathTools/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../testing/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                    <li>
                        <a href="https://github.com/yakworks/gorm-tools">yakworks/gorm-tools
                        </a>
                    </li>
            </ul>
        </div>
    </div>
</div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#dateutil">DateUtil</a></li>
            <li><a href="#parsing-a-date-in-a-string">Parsing a date in a string</a></li>
            <li><a href="#converting-date-instance-to-a-string">Converting Date instance to a string</a></li>
            <li><a href="#get-the-difference-now-and-a-specified-date-in-hours">Get the difference now and a specified date in hours</a></li>
            <li><a href="#get-the-difference-between-dates">Get the difference between dates</a></li>
        <li class="main "><a href="#multiformatdateconverter">MultiFormatDateConverter</a></li>
        <li class="main "><a href="#dealing-with-timezones-when-storing-dates">Dealing with timezones when storing dates.</a></li>
            <li><a href="#references-on-this">References on this</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<p>Gorm-tools provides a set of static utils which allow us to manipulate with dates much easier.</p>
<h2 id="dateutil">DateUtil</h2>
<p>See <a href="https://github.com/yakworks/gorm-tools/blob/master/plugin/src/main/groovy/gorm/tools/beans/DateUtil.groovy">DateUtil</a></p>
<h3 id="parsing-a-date-in-a-string">Parsing a date in a string</h3>
<p><code>stringToDate</code> expects a string with date in the simple format <code>yyyy-MM-dd</code> and returns Date instance:</p>
<pre><code class="groovy">     Date date = DateUtil.stringToDate(&quot;2017-10-19&quot;)

     assert date
     assert date == new SimpleDateFormat(&quot;yyyy-MM-dd&quot;).parse(&quot;2017-10-19&quot;)
</code></pre>

<p>it's a shortcut for <strong>convertStringToDateTime</strong></p>
<pre><code class="groovy">     Date date = DateUtil.convertStringToDateTime(&quot;2017-10-19&quot;, &quot;yyyy-MM-dd&quot;)

     assert date
     assert date == new SimpleDateFormat(&quot;yyyy-MM-dd&quot;).parse(&quot;2017-10-19&quot;)
</code></pre>

<h3 id="converting-date-instance-to-a-string">Converting Date instance to a string</h3>
<p><code>dateToJsonString</code> converts a date to the format <code>yyyy-MM-dd'T'HH:mm:ss.SSSZ</code></p>
<pre><code class="groovy">    Date date = new SimpleDateFormat('yyyy-MM-dd HH:mm:ss').parse('2017-10-20 22:00:00')

    String result = DateUtil.dateToJsonString(date)
    assert result == date.format(&quot;yyyy-MM-dd'T'HH:mm:ss.SSSZ&quot;)
</code></pre>

<p>it's a shortcut for <strong>dateToString</strong> method which accepts a format</p>
<pre><code class="groovy">    Date date = new SimpleDateFormat('yyyy-MM-dd HH:mm:ss').parse('2017-10-20 22:00:00')

    String result = DateUtil.dateToString(date, &quot;yyyy-MM-dd'T'HH:mm:ss.SSSZ&quot;)
    assert result == date.format(&quot;yyyy-MM-dd'T'HH:mm:ss.SSSZ&quot;)


    result = DateUtil.dateToString(date)
    assert result == date.format(&quot;MM/dd/yyyy hh:mm:ss&quot;)
</code></pre>

<h3 id="get-the-difference-now-and-a-specified-date-in-hours">Get the difference now and a specified date in hours</h3>
<pre><code class="groovy">    Calendar calendar = Calendar.getInstance()
    calendar.add(Calendar.HOUR, 1)
    calendar.add(Calendar.MINUTE, 30)

    assert 1L = DateUtil.getDateDifference_inHours(calendar.getTime())
</code></pre>

<h3 id="get-the-difference-between-dates">Get the difference between dates</h3>
<p>We can calculate get number of months between two dates, for example:</p>
<pre><code class="groovy">    SimpleDateFormat format = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;)
    Date date1 = format.parse(&quot;2017-10-19&quot;)
    Date date2 = format.parse(&quot;2017-12-19&quot;)

    2 == DateUtil.getMonthDiff(date1, date2)
</code></pre>

<p>or number of days</p>
<pre><code class="groovy">    Date now = new Date()

    assert 0 == DateUtil.getDaysBetween(now, now)
    assert -10 == DateUtil.getDaysBetween(now - 10, now)
    assert  10 == DateUtil.getDaysBetween(now + 10, now)
</code></pre>

<h2 id="multiformatdateconverter">MultiFormatDateConverter</h2>
<p>MultiFormatDateConverter extends general type conversion system for dates. It is used to date formatted string to date.</p>
<p>Under the hood it uses DateUtil and supports next formats "yyyy-MM-dd", "yyyy-MM-dd'T'HH:mm:ss.SSSZ", "yyyy-MM-dd'T'HH:mm:ssZ",
"yyyy-MM-dd'T'HH:mm:ss", "MM/dd/yy"</p>
<p>To apply it to application add a spring bean for it. The bean name could be any</p>
<h2 id="dealing-with-timezones-when-storing-dates">Dealing with timezones when storing dates.</h2>
<p>By default JDBC drivers stores and retrieves the dates/timestamps in local JVM timezone. 
However it is generally recommended to use UTC for storing dates in database. </p>
<p>There are two ways to store the date values in UTC. One is to change the default time zone of JVM using <code>TimeZone.setDefault( TimeZone.getTimeZone( "UTC" ) );</code>
However this forces to change the jvm default time zone which may not be possible in all cases.</p>
<p>Another option is to use the hibernate setting <code>hibernamte.jdbc.time_zone</code></p>
<p>With grails, the timezone which hibernate uses can be configured in <code>application.yml</code> as shown below.</p>
<pre><code class="yaml">hibernate:
    jdbc:
      time_zone: UTC
</code></pre>

<p>This will instruct hibernate to store and retrieve the dates in UTC timezone.</p>
<p>However it should be noted that if you query the date values with JDBC it will be retrieved in JVM timezone and not UTC and will need to be converted to UTC manually or use the overloaded version of ResultSet.getTimeStamp that takes calendar as second argument
Eg. <code>ResultSet#getTimestamp(int columnIndex, Calendar cal)</code></p>
<h3 id="references-on-this">References on this</h3>
<p>http://in.relation.to/2016/09/12/jdbc-time-zone-configuration-property/
https://hibernate.atlassian.net/browse/HHH-11396
https://vladmihalcea.com/2017/03/14/how-to-store-date-time-and-timestamps-in-utc-time-zone-with-jdbc-and-hibernate/
https://stackoverflow.com/questions/31965179/whats-new-in-hibernate-orm-5</p></div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>Copyright &copy; 2020 9ci Inc</p>
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>var base_url = '..';</script>
        <script data-main="../mkdocs/js/search.js" src="../mkdocs/js/require.js"></script>
        <script src="../js/base.js"></script><div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
