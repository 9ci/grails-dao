<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="9ci">
        <link rel="canonical" href="https://yakworks.github.io/gorm-tools/repository/ref/">
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Reference - Gorm Tools Grails Plugin</title>
        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
	
	<script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="../..">Gorm Tools Grails Plugin</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                    <li >
                        <a href="../..">Overview</a>
                    </li>
                    <li >
                        <a href="../../release-notes/">Release Notes</a>
                    </li>
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Repository Pattern <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../intro/">Quick Start</a>
</li>
                            
<li class="active">
    <a href="./">Reference</a>
</li>
                            
<li >
    <a href="../databinding/">Databinding</a>
</li>
                        </ul>
                    </li>
                    <li >
                        <a href="../../queries-mango/">Mango Query</a>
                    </li>
                    <li >
                        <a href="../../async/">Async</a>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Toolbox <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../id-generation/">Id Generation</a>
</li>
                            
<li >
    <a href="../../gorm-utils/">GormUtils Class</a>
</li>
                            
<li >
    <a href="../../beanPathTools/">Bean Path Tools</a>
</li>
                            
<li >
    <a href="../../working-with-dates/">Date Utils</a>
</li>
                        </ul>
                    </li>
                    <li >
                        <a href="../../testing/">Testing</a>
                    </li>
                    <li >
                        <a href="../../api-docs/">API Docs</a>
                    </li>
                    <li >
                        <a href="../../usefulLinks/">Useful Links</a>
                    </li>
                </ul>

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                    <li >
                        <a rel="next" href="../intro/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../databinding/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                    <li>
                        <a href="https://github.com/yakworks/gorm-tools">yakworks/gorm-tools
                        </a>
                    </li>
            </ul>
        </div>
    </div>
</div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#the-repository-artefact">The Repository Artefact</a></li>
            <li><a href="#implementing-a-repository">Implementing A Repository</a></li>
        <li class="main "><a href="#gormrepoentity-trait">GormRepoEntity Trait</a></li>
            <li><a href="#instance-methods-added-to-the-domains">Instance methods added to the domains</a></li>
            <li><a href="#statics-added-to-the-domain">Statics added to the domain</a></li>
        <li class="main "><a href="#repository-events">Repository Events</a></li>
            <li><a href="#methods-for-repolistener">Methods for @RepoListener</a></li>
            <li><a href="#grails-events">Grails Events</a></li>
            <li><a href="#spring-events">Spring Events</a></li>
            <li><a href="#external-refreshable-beans-for-events">External refreshable beans for Events</a></li>
        <li class="main "><a href="#repoutil-repomessage-helpers">RepoUtil, RepoMessage Helpers</a></li>
            <li><a href="#repoutil">RepoUtil:</a></li>
            <li><a href="#repomessage-contains-bunch-of-help-methods-for-creating-text-messages">RepoMessage contains bunch of help methods for creating text messages</a></li>
        <li class="main "><a href="#entityvalidationexception">EntityValidationException</a></li>
        <li class="main "><a href="#entitynotfoundexception">EntityNotFoundException</a></li>
        <li class="main "><a href="#async-batch-processing-support">Async batch processing support</a></li>
        <li class="main "><a href="#testing-support">Testing support</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h2 id="the-repository-artefact">The Repository Artefact</h2>
<p>This plugin adds a new artefact type <strong>Repository</strong>. Each domain will have a spring bean setup for it if 
one doesn't exists already.</p>
<p>A repository bean is configured for each domain with a <a href="https://yakworks.github.io/gorm-tools/api/gorm/tools/repository/DefaultGormRepo.html">DefaultGormRepo</a>{.new-tab} unless explicit repository class. <br />
The trait <a href="https://yakworks.github.io/gorm-tools/api/gorm/tools/repository/GormRepo.html">GormRepo</a>{.new-tab} implements the <a href="https://yakworks.github.io/gorm-tools/api/gorm/tools/repository/RepositoryApi.html">RepositoryApi</a>{.new-tab} interface and is what backs the DefaultGormRepo. 
You'll mostly use the <a href="https://yakworks.github.io/gorm-tools/api/gorm/tools/repository/GormRepo.html">GormRepo</a>{.new-tab} trait when creating a custom concrete implementation of a Repository.</p>
<p>Reference to a Repository for given domain class can be easily obtained by calling <code>MyDomainClass.repo</code> static method.</p>
<h3 id="implementing-a-repository">Implementing A Repository</h3>
<p>If you need to override the <a href="https://yakworks.github.io/gorm-tools/api/gorm/tools/repository/DefaultGormRepo.html">DefaultGormRepo</a> that is attached to each domain then you can create your own service
inside grails-app/repository and name it <code>YourDomainNameRepo</code> (eg <code>OrgRepo</code>). 
Plugin will automatically lookup all Repository classes and configure them as spring service beans to be used for 
your domain.</p>
<p>A Repository must either implement <a href="https://yakworks.github.io/gorm-tools/api/gorm/tools/repository/GormRepo.html">GormRepo</a> Trait or if you wish extend <a href="https://yakworks.github.io/gorm-tools/api/gorm/tools/repository/DefaultGormRepo.html">DefaultGormRepo</a></p>
<p><strong>Example:</strong></p>
<p>```groovy
 class OrgRepo implements GormRepo<Org> {</p>
<pre><code>@RepoListener
void beforeBind(Org org, Map params, BeforeBindEvent be) {
    //do some thing before bind

}

@Transactional
boolean makeInactive(Long id){
    def org = Org.get(id)
    ... do transactional stuff
    org.persist()
}
</code></pre>
<p>}
 ```</p>
<blockquote>
<p>:memo: <em>@Transactional</em>
For performance reasons, @Transactional is not needed on the class </p>
</blockquote>
<h2 id="gormrepoentity-trait">GormRepoEntity Trait</h2>
<p>See Groovydocs api for the <a href="https://yakworks.github.io/gorm-tools/api/gorm/tools/repository/GormRepoEntity.html">GormRepoEntity</a> that is injected onto all domains.</p>
<h3 id="instance-methods-added-to-the-domains">Instance methods added to the domains</h3>
<p>Every domain gets a repository which is either setup for you or setup by implementing 
<a href="https://yakworks.github.io/gorm-tools/api/gorm/tools/repository/GormRepo.html">GormRepo</a> 
Each method is transactional and will prevent incomplete cascading saves.</p>
<ul>
<li>
<p><strong>persist()</strong>: calls the GormRepo's persist which in turn calls domain.save(failOnError:true) 
  Throws a <a href="https://yakworks.github.io/gorm-tools/api/gorm/tools/repository/errors/EntityValidationException.html">EntityValidationException</a></p>
</li>
<li>
<p><strong>remove()</strong>:  calls the GormRepo's remove. 
  Throws a <a href="https://yakworks.github.io/gorm-tools/api/gorm/tools/repository/errors/EntityNotFoundException.html">EntityNotFoundException</a></p>
</li>
</ul>
<h3 id="statics-added-to-the-domain">Statics added to the domain</h3>
<ul>
<li>
<p><strong>create(params)</strong>:  calls the repo.create which does the bolier plate code you might find in a scaffolded controller. 
creates a new instance, sets the params and calls the repository.save (essentially the persist()). <strong>ex:</strong> <code>Book.insertAndSave([name:'xyz',isbn:'123'])</code>
Throws a <a href="https://yakworks.github.io/gorm-tools/api/gorm/tools/repository/errors/EntityValidationException.html">EntityValidationException</a> if anything goes wrong</p>
</li>
<li>
<p><strong>update(params)</strong>:  calls the repo.update which does the boiler plate code you might find in a scaffolded controller. gets the instance base in the params.id, sets the params and calls the repository.save for it. <strong>ex:</strong> Book.update([id:11,name:'aaa']) Throws a <a href="https://yakworks.github.io/gorm-tools/api/gorm/tools/repository/errors/EntityValidationException.html">EntityValidationException</a> if anything goes wrong</p>
</li>
<li>
<p><strong>remove(id)</strong>:  calls the repository.removeById gets the instance base in the params.id, calls the delete for it. <strong>ex:</strong> <code>Book.remove([id:11])</code>
Throws a <a href="https://yakworks.github.io/gorm-tools/api/gorm/tools/repository/errors/EntityNotFoundException.html">EntityNotFoundException</a> if anything goes wrong</p>
</li>
<li>
<p><strong>repo</strong>: a quick way to get to the repository for the Domain. It will return the DefaultGormRepo that was auto created 
  or one you defined for the domain under grails-app/repository.</p>
</li>
</ul>
<h2 id="repository-events">Repository Events</h2>
<h3 id="methods-for-repolistener">Methods for @RepoListener</h3>
<p>Each Repository can implement any of the methods listed below and they will get called during persistence operation if they have the @RepoListener annotation.  </p>
<ul>
<li><strong>beforeBind(T instance, Map data, BeforeBindEvent be)</strong> - Called before a new instance is saved, can be used to do custom data binding or initialize the state of domain etc.</li>
<li><strong>afterBind(T instance, Map data, AfterBindEvent be)</strong> -  Called after databinding is performed.  </li>
<li><strong>beforePersist(T instance, BeforePersistEvent e)</strong> - Called every time before an instance is saved.  </li>
<li><strong>afterPersist(T instance, AfterPersistEvent e)</strong> - Called every time after an instance is saved.</li>
<li><strong>beforeRemove(T instance, BeforeRemoveEvent e)</strong> - Called before an instance is deleted. Can be utilized to cleanup related records etc.  </li>
<li><strong>afterRemove(T instance, AfterRemoveEvent e)</strong> -  Called After an instance is deleted.  </li>
</ul>
<h3 id="grails-events">Grails Events</h3>
<p>The Repository also provides a possibility to handle events using Grails annotations. Please see docs for <a href="http://async.grails.org/latest/guide/index.html#events">Grails Events</a>{.new-tab}.</p>
<h4 id="publishing-events">Publishing events</h4>
<p>Grails provides two ways for creating events - using <a href="http://async.grails.org/latest/api/grails/events/annotation/Publisher.html">@Publisher</a>{.new-tab} annotation on a method and using
<a href="http://async.grails.org/latest/api/grails/events/bus/EventBus.html">EventBus</a>{.new-tab} directly, please see docs for <a href="http://async.grails.org/latest/guide/index.html#notifying">Event Publishing</a>{.new-tab}.
In case of using publisher annotation Grails takes event id from the method name (method with <a href="http://async.grails.org/latest/api/grails/events/annotation/Publisher.html">@Publisher</a>{.new-tab} annotation).
If using <a href="http://async.grails.org/latest/api/grails/events/bus/EventBus.html">EventBus</a>{.new-tab} we should specify event id manually.</p>
<p>By default Repository uses <a href="http://async.grails.org/latest/api/grails/events/bus/EventBus.html">EventBus</a>{.new-tab} to create events (see <a href="https://yakworks.github.io/gorm-tools/api/gorm/tools/repository/events/RepoEventPublisher.html">RepoEventPublisher</a>{.new-tab}).
It publishes a number of <a href="https://yakworks.github.io/gorm-tools/api/gorm/tools/repository/events/package-summary.html">Repository Events</a>{.new-tab} and provides it's own way to build event ids.
All ids of repository events correspond to the format <code>&lt;domainName&gt;.&lt;eventTypeName&gt;</code>.
As we can see there are two values separated with a dot. The first comes a name of a domain class, for which an event
is created and the second - a type of a specific repository event. For example, in case we call <code>persist()</code> method
on a domain entity called <code>Org</code>, the repository invokes several events, one of them is BeforePersist event with id <code>Org.beforePersist</code>.</p>
<h4 id="subscribing-to-events">Subscribing to events</h4>
<p>Grails provides several options for handling events, please see Grails docs for <a href="http://async.grails.org/latest/guide/index.html#consuming">Event Handling</a>.</p>
<p>In case of adding <a href="http://async.grails.org/latest/api/grails/events/annotation/Subscriber.html">@Subscriber</a>{.new-tab} annotation to a method, Grails determines event id from the method name
by default. For example, methods like <code>someEvent()</code> or <code>onSomeEvent()</code> listen to the event with id <code>someEvent</code>.</p>
<p>Due to the fact that ids of repository events contain <code>.</code> symbol, we should pass event id to the Subscriber annotation like so:</p>
<pre><code class="groovy">    @Subscriber(&quot;SomeDomain.someEvent&quot;)
    void someMethod() {}
</code></pre>

<p>According to Grails docs, a class which contains a listener method (with <a href="http://async.grails.org/latest/api/grails/events/annotation/Subscriber.html">@Subscriber</a>{.new-tab} annotation) should be a <strong>spring bean</strong>.</p>
<p>Please see the example with <code>OrgSubscriber</code> below:</p>
<p><strong>Example</strong></p>
<pre><code class="groovy">import grails.events.annotation.Subscriber
import gorm.tools.repository.events.BeforePersistEvent
import gorm.tools.repository.events.AfterPersistEvent

class OrgSubscriber {

    @Subscriber(&quot;Org.beforePersist&quot;)
    void beforePersist(BeforePersistEvent event) {
       // ...
    }

    @Subscriber(&quot;Org.afterPersist&quot;)
    void afterPersist(AfterPersistEvent event) {
       // ...
    }
}

</code></pre>

<p>In this example we can see two listeners which handle events that occur before and after
persisting an entity of the Org domain class.</p>
<h3 id="spring-events">Spring Events</h3>
<p>Spring events are recomended over grails.events as they are much more performant if processing large numbers of domains
The Repository also publishes a number of 
<a href="https://yakworks.github.io/gorm-tools/api/gorm/tools/repository/events/package-summary.html">events as listed in the Groovydoc API</a></p>
<p><strong>Example</strong>  </p>
<pre><code class="groovy">import org.springframework.context.event.EventListener
import gorm.tools.repository.events.BeforeBindEvent

class OrgListener {

    @EventListener
    void beforeBind(BeforeBindEvent&lt;Org&gt; event) {
       Org org = event.entity
       //Do some thing here.
    }
}

</code></pre>

<blockquote>
<p>:memo: 
Calling methods which trigger events inside an event listener causes an infinite loop</p>
</blockquote>
<h3 id="external-refreshable-beans-for-events">External refreshable beans for Events</h3>
<p>Since 2.0 Spring added support for defining beans using supported dynamic languages. Eg. groovy. 
This makes it possible to create groovy script files outside of application which contains class definition, and use it as spring bean.
This feature can be used to create refreshable beans, spring will watch the external script for changes and automatically reload the bean if it has changed.
The interval can be configured using <code>refresh-check-delay</code>. This feature makes it possible to externalize the event listeners outside of application.</p>
<p>Here is an example of how to use an external refreshable bean as event listener. </p>
<p>Create a groovy script containing bean definition for event listener some where on file system out side of grails application directory.</p>
<p><strong>File</strong> <code>OrgEventListener.groovy</code></p>
<pre><code class="groovy">import grails.events.annotation.Subscriber
import gorm.tools.repository.events.BeforePersistEvent
import gorm.tools.repository.events.AfterPersistEvent

public class OrgEventListener {

      @Subscriber(&quot;Org.beforePersist&quot;)
      void beforePersist(BeforePersistEvent e){
          Org org = (Org) e.entity
          //do some thing with org
      }

      @Subscriber(&quot;Org.afterPersist&quot;)
      void afterPersist(AfterPersistEvent e){
          Org org = (Org) e.entity
          //do some thing with org
      }
}
</code></pre>

<p>The above example uses <code>Subscriber</code> annotation from <a href="https://async.grails.org">Grails async</a> project. The event handler methods will get called asynchronously and does not take part in transaction.
Repository also publishes events using spring event mechanism which can be used to define event listeners which gets called synchronously and takes part in current transaction. </p>
<p>Following example shows how to define synchronous event listener.</p>
<pre><code class="groovy">import org.springframework.context.ApplicationListener 
import gorm.tools.repository.events.BeforePersistEvent

class OrgEventListener implements ApplicationListener&lt;BeforePersistEvent&lt;Org&gt;&gt;  {

    void onApplicationEvent(BeforePersistEvent&lt;Org&gt; event) {
        Org org = event.entity
        //dome some thing with org.
    }
} 

</code></pre>

<p>Define <code>OrgEventListener</code> as spring bean in <code>grails-app/conf/spring/resources.groovy</code></p>
<pre><code class="groovy">
 xmlns lang: &quot;http://www.springframework.org/schema/lang&quot;
 lang.groovy(id: &quot;orgEventListener&quot;, 'script-source': &quot;file:&lt;path to OrgEventListener.groovy&gt;&quot;, 'refresh-check-delay': 1000)

</code></pre>

<p>Now the <code>refreshableBean</code> can be injected into any other bean. Spring will reload it automatically if the RefreshableBean.groovy changes.</p>
<p>See <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/languages.html#groovy">Spring dynamic languages support</a> for more details on dynamic language support.</p>
<h2 id="repoutil-repomessage-helpers">RepoUtil, RepoMessage Helpers</h2>
<p>See <a href="https://yakworks.github.io/gorm-tools/api/gorm/tools/repository/RepoUtil.html">RepoUtil</a></p>
<h4 id="repoutil">RepoUtil:</h4>
<p><strong>checkFound(entity, Map params,String domainClassName)</strong> checks does the entity exists, if not throws <a href="https://yakworks.github.io/gorm-tools/api/gorm/tools/repository/errors/EntityNotFoundException.html">EntityNotFoundException</a> with human readable error text</p>
<p><strong>checkVersion(entity,ver)</strong> checks the passed in version with the version on the entity (entity.version) make sure entity.version is not greater, throws OptimisticLockingFailureException</p>
<p><strong>flush()</strong> flushes the session</p>
<p><strong>clear()</strong> clears session cache</p>
<p><strong>flushAndClear()</strong> flushes the session and clears the session cache</p>
<h4 id="repomessage-contains-bunch-of-help-methods-for-creating-text-messages">RepoMessage contains bunch of help methods for creating text messages</h4>
<p>See <a href="https://yakworks.github.io/gorm-tools/api/gorm/tools/repository/RepoMessage.html">RepoMessage</a></p>
<p>The example below shows how to build <code>saved</code> message for a domain:</p>
<pre><code class="groovy">
    User user = new User(id:100,version:1)

    Map msg = RepoMessage.saved(user)
    assert 'default.saved.message' == msg.code //i18 code
    assert 100 == msg.args[1]

</code></pre>

<p>List of available messages</p>
<ul>
<li>saved</li>
<li>not saved</li>
<li>updated</li>
<li>not updated</li>
<li>deleted</li>
<li>not deleted</li>
<li>notFound</li>
<li>optimisticLockingFailure - Another user has updated the resource while you were editing</li>
</ul>
<p>Gorm-tools provides its own types of exceptions to handle errors which relate to domains.</p>
<h2 id="entityvalidationexception">EntityValidationException</h2>
<p>See <a href="https://yakworks.github.io/gorm-tools/api/gorm/tools/repository/errors/EntityValidationException.html">EntityValidationException</a></p>
<p>An extension of the default ValidationException. It is possible to pass the entity and the message map.</p>
<h2 id="entitynotfoundexception">EntityNotFoundException</h2>
<p>See <a href="https://yakworks.github.io/gorm-tools/api/gorm/tools/repository/errors/EntityNotFoundException.html">EntityNotFoundException</a></p>
<p>An extension of the EntityValidationException to be able to handle rest request which should respond with 404 error.</p>
<h2 id="async-batch-processing-support">Async batch processing support</h2>
<p>Plugin makes it easy to process list of batches asynchronously with transaction using <a href="https://yakworks.github.io/gorm-tools/api/gorm/tools/async/AsyncSupport.html">AsyncSupport</a>. 
<a href="https://yakworks.github.io/gorm-tools/api/gorm/tools/async/GparsAsyncSupport.html">GparsAsyncSupport</a> is default implementation provided by the plugin.</p>
<p><strong>batchSize</strong> - Is the batchsize used for slicing the list. The default value is obtained from <code>hibernate.jdbc.batch_size</code> configuration setting. However it can be explicitely passed in args as shown in below example.<br />
<strong>poolSize</strong> - Is the size of Gpars thread pool used by <code>GparsAsyncSupport</code>. The default value can configured using <code>gpars.poolsize</code>. If not configured, it will use the default poolsize used by Gpars. which is available processors + 1</p>
<p><strong>Example</strong>:</p>
<pre><code class="groovy">
class TestService {
    AsyncSupport asyncSupport

    void insertBatches(List&lt;Map&gt; list) {
        asyncSupport.parallelCollate([batchSize:100], list) { Map record, Map args -&gt;
            Org.create(record)
        }
    }

}

</code></pre>

<p>The above code snippet will slice the list into batches of 100 and run each batch in parallel and wrap it in transaction. </p>
<p>The list can be processed in parallel without it being wrapped in transaction using <code>asyncSupport.parallel</code> method.</p>
<pre><code class="groovy">
asyncSupport.parallel(asyncSupport.collate(list)) { List batch, Map args -&gt;
    //do some thing with the batch.
}

</code></pre>

<h2 id="testing-support">Testing support</h2>
<p>Plugin provides <a href="https://yakworks.github.io/gorm-tools/api/gorm/tools/testing/GormToolsTest.html">GormToolsTest</a> and <a href="https://yakworks.github.io/gorm-tools/api/gorm/tools/testing/GormToolsHibernateSpec.html">GormToolsHibernateSpec</a>
To make it easy to write tests which utilizes repository.</p>
<p><strong>Writing unit tests using GormToolsTest</strong><br />
GormToolsTest extends grails DataTest and configures a repository bean for every mock domain.<br />
The repository class must exist in same package as the domain class, or else, it will configure 
DefaultGormRepo as the repository for the given domain.</p>
<pre><code class="groovy">
class CitySpec extends Specification implements GormToolsTest {

   void setup() {
     mockDomain(City)
   }

   void &quot;test create&quot;() {
     given:
     Map params = [name:&quot;Chicago&quot;]

     when:
     City city = City.create(params)

     then:
     city.name == &quot;Chicago&quot;
   }
}
</code></pre>

<p><strong>GormToolsHibernateSpec</strong><br />
GormToolsHibernateSpec extends HibernateSpec and setups repository beans for domains. 
Can be used to unit test with full hibernate support with inmemory database.</p>
<pre><code class="groovy">
class CitySpec extends GormToolsHibernateSpec {

  List&lt;Class&gt; getDomainClasses() { [City] }

   void &quot;test create&quot;() {
     given:
     Map params = [name:&quot;Chicago&quot;]

     when:
     City city = City.create(params)
     //or City.repo.create(params)

     then:
     city.name == &quot;Chicago&quot;
   }
}
</code></pre>

<p>When <code>getDomainClasses()</code> is overridden GormToolsHibernateSpec will try to find the repository in the same package as domain class. 
Alternatively if <code>getPackageToScan()</code> is provided, it will find all the repository from the given package and below it. </p>
<p><strong>DomainAutoTest</strong>
Also plugin provides <a href="https://yakworks.github.io/gorm-tools/api/gorm/tools/testing/DomainAutoTest.html">DomainAutoTest</a> abstract class that contains default tests cases for CRUD operations. 
<code>DomainAutoTest</code> will mock the domain, setup and create the data for you then exercise the domain and the default repository service for you.
See example bellow:</p>
<pre><code class="groovy">
import gorm.tools.testing.hibernate.AutoHibernateSpec
import testing.Project

class ProjectSpec extends AutoHibernateSpec&lt;Project&gt; {

    /** automatically runs tests on persist(), create(), update(), delete().*/

}

</code></pre>

<p>The next methods will be added and executed for Project class:</p>
<ul>
<li>test_create</li>
<li>test_update</li>
<li>test_persist</li>
<li>test_delete</li>
</ul>
<p>Each of them can be overridden by the method with the same name if needed. </p>
<p>Test data is build with help of <a href="https://yakworks.github.io/gorm-tools/api/gorm/tools/testing/BuildExampleHolder.html">BuildExampleData</a> and [BuildExampleHolder]. </p>
<p>BuildExampleHolder - is a holder that stores BuildExampleData instances for domains, to avoid creating of the same values 
several times</p>
<p>BuildExampleData is class that builds test data based on <code>example</code> property from constraints section. If domain class has association
that shouldn't be <code>null</code>(has constrain <code>nullable: false</code>), creates test data for it to, left null otherwise.
Dates in <code>example</code> should be string format, they will be parsed to dates.</p></div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>Copyright &copy; 2020 9ci Inc</p>
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>var base_url = '../..';</script>
        <script data-main="../../mkdocs/js/search.js" src="../../mkdocs/js/require.js"></script>
        <script src="../../js/base.js"></script><div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
