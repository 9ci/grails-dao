buildscript {
	repositories {
		mavenLocal()
		maven { url "https://repo.grails.org/grails/core" }
	}
	dependencies {
		classpath "org.grails:grails-gradle-plugin:$grailsVersion"
		classpath "org.grails:grails-docs:$grailsVersion"
		//classpath 'com.jfrog.bintray.gradle:gradle-bintray-plugin:1.7.3'
		classpath 'io.github.groovylang.groovydoc:groovydoc-gradle-plugin:1.0.1'
	}
}

apply plugin: 'idea'
apply plugin:'groovy'

repositories {
	mavenLocal()
	maven { url "https://repo.grails.org/grails/core" }
}

//Root project and view-tools plugin uses same version.
version project.projectVersion

project(':dao') {
	version = project.projectVersion
}

ext {
	commonBuild = "https://raw.githubusercontent.com/yakworks/grails-common-build/master"
	grailsApps = ['test-app']
	grailsPlugins = ['dao']
}


subprojects {

	boolean isGrailsApp = grailsApps.contains(project.name)
	boolean isGrailsPlugin = grailsPlugins.contains(project.name)
	boolean isGrailsProject = isGrailsApp || isGrailsPlugin
	boolean isBuildSnapshot = version.toString().endsWith("-SNAPSHOT")

	println project.name + ":" + version.toString()

	ext {
		userOrg = "grails"
		set "tomcat.version", "8.5.5"
		isSnapshot = isBuildSnapshot
	}

	apply from:"$commonBuild/common.gradle"

	if (isGrailsPlugin) {
		apply from: "${commonBuild}/common-plugin.gradle"
		apply from: "${commonBuild}/common-publishing.gradle"
		group "org.grails.plugins"
	}

	if (isGrailsApp) {
		apply from: "${commonBuild}/common-project.gradle"
		group "org.grails"
	}

    // Added to be able to see failed tests and the cause in console on test run
    integrationTest {
        //Allows to set options related to which test events are logged to the console, and on which detail level.
        // For example, to show more information about exceptions use
        // for more information take a look https://docs.gradle.org/current/dsl/org.gradle.api.tasks.testing.logging.TestLoggingContainer.html
        testLogging {
            exceptionFormat = 'full'
            events "failed"//, "passed", "skipped", "standardOut", "standardError"
        }

        // Uncomment line bellow to show in console all tests that were executed in next format:
            //:test-app:integrationTest
            //-- Test Check list(daoapp.OrgSpec)
            //-- Test Filter by Name eq(daoapp.OrgSpec)

        //beforeTest { descriptor -> logger.quiet " -- $descriptor" }
    }

    test {
        testLogging.showStandardStreams = true
        testLogging.exceptionFormat = 'full'
    }

}
