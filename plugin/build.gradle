apply plugin: 'codenarc'

//bootRepackage and maybe addResources are needed for the test-projects grails.plugin.compile depndency to work
bootRun {
	jvmArgs('-Dspring.output.ansi.enabled=always')
	addResources = true
}
bootRepackage.enabled = false


dependencies {

    compileOnly "org.springframework:spring-test"
    //this is for GrailsParameterMapRowMapper that uses the MockHttpServletRequest
    compileOnly "org.springframework.data:spring-data-commons" //:1.12.10.RELEASE

    //used for bundled Test traits
    compileOnly "org.grails:grails-gorm-testing-support"
    compileOnly "org.grails:grails-web-testing-support"

    codenarc 'org.codenarc:CodeNarc:0.27.0'
}

codenarc {
    toolVersion = '0.27.0'
    config = project.resources.text.fromString("${commonBuild}/codenarc/rules.groovy".toURL().text)
    reportFormat = 'html'
    //ignoreFailures = true

    maxPriority1Violations = 0
    maxPriority2Violations = 4
    maxPriority3Violations = 8
}

codenarcMain {
    exclude '**/GormScalars.groovy'
}

codenarcTest {
    ignoreFailures = true
}

//this makes the groovy docs much more readable by shorting packages and providing links
groovydoc {
    excludes = ['**/*GrailsPlugin.groovy','**/Application.groovy' ]
    link('http://download.oracle.com/javase/8/docs/api/', 'java.', 'org.xml', 'javax.', 'org.xml.')
    link("https://docs.spring.io/spring/docs/4.2.x/javadoc-api/", 'org.springframework')
    link('http://groovy.codehaus.org/api/',  'groovy.', 'org.codehaus.groovy.')
    link('https://docs.grails.org/3.3.x/api',  'grails.', 'org.grails.')
    link('http://gorm.grails.org/latest/hibernate/api/',  'grails.gorm', 'grails.orm', 'org.grails.datastore', 'org.grails.orm')
}

